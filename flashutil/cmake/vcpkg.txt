# VCPKG on UNIX based systems has no sense - system libraries should be used
if (WIN32 OR (UNIX AND (DEFINED USE_VCPKG)))
	if (NOT DEFINED VCPKG_ROOT)
		message(STATUS "Using local VCPKG")
		
		set(VCPKG_ROOT "${CMAKE_CURRENT_LIST_DIR}/vcpkg")
	else()
		if (WIN32)
			warning(STATUS "Detected globally integrated VCPKG at ${VCPKG_ROOT}, overwriting it by local one")
			
			set(VCPKG_ROOT "${CMAKE_CURRENT_LIST_DIR}/vcpkg")
		else()
			message(STATUS "Using system VCPKG")
		endif()
	endif()

	if (DEFINED VCPKG_ROOT AND NOT DEFINED CMAKE_TOOLCHAIN_FILE)
		if (WIN32)
			set(X_VCPKG_APPLOCAL_DEPS_INSTALL ON)
		endif()

		message(STATUS "Setting toolchain file from VCPKG")
		set(CMAKE_TOOLCHAIN_FILE "${VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake" CACHE STRING "")
	endif()
	
	if (WIN32)
		set(VCPKG_EXEC ${VCPKG_ROOT}/vcpkg.exe)
		set(VCPKG_BOOTSTRAP ${VCPKG_ROOT}/bootstrap-vcpkg.bat)
	else()
		set(VCPKG_EXEC ${VCPKG_ROOT}/vcpkg)
		set(VCPKG_BOOTSTRAP ${VCPKG_ROOT}/bootstrap-vcpkg.sh)
	endif()
	
	if(NOT EXISTS ${VCPKG_EXEC})
		message("Bootstrapping vcpkg in ${VCPKG_ROOT}")
		execute_process(COMMAND ${VCPKG_BOOTSTRAP} WORKING_DIRECTORY ${VCPKG_ROOT})
	endif()

	if(NOT EXISTS ${VCPKG_EXEC})
		message(FATAL_ERROR "***** FATAL ERROR: Could not bootstrap vcpkg *****")
	endif()
endif()
